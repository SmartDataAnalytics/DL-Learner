/**
 * 
 */
package org.dllearner.algorithms.isle.index;

import java.util.Collections;
import java.util.HashSet;
import java.util.Set;

/**
 * @author Lorenz Buehmann
 *
 */
public class Token {
	
	private String rawForm;
	private String stemmedForm;
	private String posTag;
	private boolean isPunctuation;
	private boolean isStopWord;
    /// for storing alternative forms of this token, e.g., generated by WordNet synonyms
    private HashSet<String> alternativeForms;
	
	public Token(String rawForm) {
		this.rawForm = rawForm;
	}
	
	public Token(String rawForm, String stemmedForm, String posTag, boolean isPunctuation, boolean isStopWord) {
		this.rawForm = rawForm;
		this.stemmedForm = stemmedForm;
		this.posTag = posTag;
		this.isPunctuation = isPunctuation;
		this.isStopWord = isStopWord;
        this.alternativeForms = new HashSet<>();
	}

	/**
	 * @return the rawForm
	 */
	public String getRawForm() {
		return rawForm;
	}
	
	/**
	 * @return the stemmedForm
	 */
	public String getStemmedForm() {
		return stemmedForm;
	}
	
	/**
	 * @return the posTag
	 */
	public String getPOSTag() {
		return posTag;
	}

    /**
     * Returns the unmodifiable list of alternative surface forms for this token. These alternative forms might be
     * generated by, e.g., WordNet synonym expansion.
     *
     * @return unmodifiable set of alternative surface forms for this token
     */
    public Set<String> getAlternativeForms() {
        return Collections.unmodifiableSet(alternativeForms);
    }

    /**
     * Adds a new surface form to the alternative forms of this token. Alternative forms are included in comparison of
     * two tokens when using the {@link #equalsWithAlternativeForms}.
     */
    public void addAlternativeForm(String alternativeForm) {
        this.alternativeForms.add(alternativeForm);
    }

    /**
	 * @return the isPunctuation
	 */
	public boolean isPunctuation() {
		return isPunctuation;
	}
	
	/**
	 * @return the isStopWord
	 */
	public boolean isStopWord() {
		return isStopWord;
	}
	
	/**
	 * @param stemmedForm the stemmedForm to set
	 */
	public void setStemmedForm(String stemmedForm) {
		this.stemmedForm = stemmedForm;
	}
	
	/**
	 * @param posTag the posTag to set
	 */
	public void setPOSTag(String posTag) {
		this.posTag = posTag;
	}
	
	/**
	 * @param isPunctuation the isPunctuation to set
	 */
	public void setIsPunctuation(boolean isPunctuation) {
		this.isPunctuation = isPunctuation;
	}
	
	/**
	 * @param isStopWord the isStopWord to set
	 */
	public void setIsStopWord(boolean isStopWord) {
		this.isStopWord = isStopWord;
	}

	/* (non-Javadoc)
	 * @see java.lang.Object#toString()
	 */
	@Override
	public String toString() {
		return "[Word: " + rawForm + " | Stemmed word: " + stemmedForm + " | POS tag: " + posTag + "]";
	}

    /**
     * Compares the given token to this one including alternative forms. This means that tokens are considered to be
     * equal iff the POS tags is the same and if the intersection of all surface forms (stemmed forms + alternative
     * forms) is not empty.
     *
     * @param other    token to compare this token to
     * @return true if tokens are equal considering alternative forms, otherwise false
     */
    public boolean equalsWithAlternativeForms(Token other) {
        if (this == other) {
            return true;
        }

        if (!posTag.equals(other.posTag)) {
            return false;
        }

        if (other.stemmedForm.equals(stemmedForm) || other.alternativeForms.contains(stemmedForm) ||
                alternativeForms.contains(other.stemmedForm)) {
            return true;
        }

        return false;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) {
            return true;
        }
        if (o == null || getClass() != o.getClass()) {
            return false;
        }

        Token token = (Token) o;

        if (!posTag.equals(token.posTag)) {
            return false;
        }
        if (!stemmedForm.equals(token.stemmedForm)) {
            return false;
        }

        return true;
    }

    @Override
    public int hashCode() {
        int result = stemmedForm.hashCode();
        result = 31 * result + posTag.hashCode();
        return result;
    }

    public static void main(String[] args) {
        Token t1 = new Token("requirement", "requirement", "NN", false, false);
        t1.addAlternativeForm("demand");
        t1.addAlternativeForm("condition");

        Token t2 = new Token("demand", "demand", "NN", false, false);
        t2.addAlternativeForm("must");


        Token t3 = new Token("must", "must", "NN", false, false);
        t1.addAlternativeForm("condition");

        Token t4 = new Token("mustache", "mustache", "NN", false, false);


        Token[] tokens = new Token[]{t1, t2, t3, t4};

        for (Token t : tokens) {
            for (Token o : tokens) {
                System.out.println(t + " - " + o + " --> " + t.equalsWithAlternativeForms(o));
            }
        }
    }
}
